const questionBank = {

    easy: [
        {
            definition: "It refers to fair and equal treatment of all people regardless of gender, race, or status.",
            correct: "equality",
            wrong: ["eiquality", "equaliety"]
        },
        {
            definition: "A student is not allowed to join an activity because of their religion. What social issue is shown?",
            correct: "Discrimination",
            wrong: ["Dismrictiona", "Dicseimination"]
        },
        {
            definition: "The condition where people lack money, food, and basic needs.",
            correct: "Poverty",
            wrong: ["Porevyt", "Provety"]
        },
        {
            definition: "What is the range of actions of organisms, individuals, systems or artificial entities in some environment?",
            correct: "behavior",
            wrong: ["behaviour", "behaevior"]
        },
        {
            definition: "Who wrote the novel Noli Me Tangere?",
            correct: "Jose Rizal",
            wrong: ["Jose Rizel", "JosÃ© Rizall"]
        },
        {
            definition: "A person who organizes and operates a business, taking on greater than normal financial risks in order to do so.",
            correct: "Entrepreneur",
            wrong: ["Entrepeneur", "Entepreneur"]
        },
        {
            definition: "The study of languages and their structures.",
            correct: "Linguistic",
            wrong: ["Lingguistic", "Lingwistic"]
        },
        {
            definition: "The study of human behavior and mind is called?",
            correct: "Psychology",
            wrong: ["Psycology", "Psychollogy"]
        },
        {
            definition: "A philosopher who emphasized virtue ethics and moral character.",
            correct: "Aristotle",
            wrong: ["Aristole", "Ayistotle"]
        },
        {
            definition: "The quality of being thankful; readiness to show appreciation.",
            correct: "Gratitude",
            wrong: ["Gratitute", "Greatitude"]
        },
        {
            definition: "A government ruled by a king or queen.",
            correct: "Monarchy",
            wrong: ["Monarchie", "Monarcy"]
        },
        {
            definition: "A person who studies the stars and planets.",
            correct: "Astronomer",
            wrong: ["Astronemer", "Astronomir"]
        },
        {
            definition: "The study of past events especially human history is called?",
            correct: "History",
            wrong: ["Histry", "Histori"]
        },
        {
            definition: "The science that studies weather and atmosphere is called?",
            correct: "Meteorology",
            wrong: ["Meterology", "Meteology"]
        },
        {
            definition: "A device used to look at very small objects.",
            correct: "Microscope",
            wrong: ["Mycroscope", "Microscop"]
        },
        {
            definition: "The ancient pyramids are located in which country?",
            correct: "Egypt",
            wrong: ["Egipt", "Egyipt"]
        },
        {
            definition: "The famous ship that sank in 1912 was called?",
            correct: "RMS Titanic",
            wrong: ["Titanik", "Titannic"]
        },
        {
            definition: "The largest planet in the solar system is?",
            correct: "Jupiter",
            wrong: ["Jupitar", "Jupeter"]
        },
        {
            definition: 'Who was known as the "Brains of the Revolution"?',
            correct: "Apolinario Mabini",
            wrong: ["Apolinareo Mabini", "Apolinario Mabeni"]
        },
        {
            definition: "A government official uses public money for personal gain. What is this called?",
            correct: "Corruption",
            wrong: ["Coruption", "Curroption"]
        }
    ],

    normal: [
        {
            definition: "The spreading of false or misleading information to influence public opinion.",
            correct: "Disinformation",
            wrong: ["Dissimformation", "Disformation"]
        },
        {
            definition: "Who was the first Filipino Archbishop of Manila?",
            correct: "Jorge Barlin",
            wrong: ["George Barlin", "Jorge Barlinn"]
        },
        {
            definition: "A community campaign encouraging people to speak up about environmental protection.",
            correct: "Advocacy",
            wrong: ["Advocaci", "Advoccacy"]
        },
        {
            definition: "The movement of people from one country to another to live or work.",
            correct: "migration",
            wrong: ["Immigration", "imigraition"]
        },
        {
            definition: "A literary device where a word imitates the sound it represents.",
            correct: "Onomatopoeia",
            wrong: ["Onomatopeia", "Onomatopia"]
        },
        {
            definition: "The conformity to the law or rules.",
            correct: "Legitimacy",
            wrong: ["Legitmacy", "ligetmacy"]
        },
        {
            definition: "It is the theory of knowledge.",
            correct: "Epistemology",
            wrong: ["Epistomology", "Ipestemology"]
        },
        {
            definition: "The branch of philosophy that studies moral principle is?",
            correct: "Ethics",
            wrong: ["Ethicks", "Ethiccs"]
        },
        {
            definition: 'A philosopher who wrote "The Republic" and discussed justice in society.',
            correct: "Plato",
            wrong: ["Platoe", "Platto"]
        },
        {
            definition: "The discipline that studies human culture is?",
            correct: "Anthropology",
            wrong: ["Antropology", "Anthnropology"]
        },
        {
            definition: "The ability to understand and share the feelings of another.",
            correct: "Empathy",
            wrong: ["Empithy", "Empathe"]
        },
        {
            definition: "A statement that seems self-contradictory but may reveal a truth.",
            correct: "Paradox",
            wrong: ["Paradoxx", "Paradoks"]
        },
        {
            definition: "The practice of pretending to have beliefs or feelings that one does not actually have.",
            correct: "Hypocrisy",
            wrong: ["Hipocrisy", "Hypocrasy"]
        },
        {
            definition: "The system of government ruled by the people is called?",
            correct: "Democracy",
            wrong: ["Democrasy", "Democraci"]
        },
        {
            definition: "Who painted the Mona Lisa?",
            correct: "Leonardo da Vinci",
            wrong: ["Leonardo da Vinsi", "Leonardo da Venci"]
        },
        {
            definition: "The first President of the United States was?",
            correct: "George Washington",
            wrong: ["Gorge Washington", "George Washingten"]
        },
        {
            definition: "Who was the leader of Germany during World War II?",
            correct: "Adolf Hitler",
            wrong: ["Adolf Hittler", "Adolph Hittler"]
        },
        {
            definition: "Who founded the Katipunan?",
            correct: "Andres Bonifacio",
            wrong: ["Andress Bonifacio", "Andres Bonifaciuo"]
        },
        {
            definition: "Any of a genus of ornamental shrubs of the evening-primrose family having showy nodding flowers usually in deep pinks, reds, and purples.",
            correct: "Fuchsia",
            wrong: ["Fusia", "Fucsia"]
        },
        {
            definition: "The economic term for increase in general prices over time.",
            correct: "Inflation",
            wrong: ["Infflation", "Inflasion"]
        }
    ],

    hard: [
        {
            definition: "A belief system that prioritizes male dominance and limits women's opportunities in society.",
            correct: "Patriarchy",
            wrong: ["Patriarchie", "Patrirachy"]
        },
        {
            definition: "The unequal distribution of wealth, power, and opportunities among different groups in society.",
            correct: "Social Stratification",
            wrong: ["Sucial Strafitication", "Sociall Strifatication"]
        },
        {
            definition: "A situation where people remain poor because social systems limit access to education and employment.",
            correct: "Structural Inequality",
            wrong: ["Stractoral Eniqaulity", "Structrural Einequality"]
        },
        {
            definition: "A complex administrative system.",
            correct: "Bureaucracy",
            wrong: ["Beureaucracy", "Beurucracy"]
        },
        {
            definition: "The act of wishing to do what is right.",
            correct: "Conscientious",
            wrong: ["Consientious", "Consentious"]
        },
        {
            definition: "It is the final part of a narrative.",
            correct: "Denouement",
            wrong: ["Denoument", "denoment"]
        },
        {
            definition: "It is a system of ranking.",
            correct: "Hierarchy",
            wrong: ["Hirarchy", "Heirarchy"]
        },
        {
            definition: "Social issue involving spreading false information online.",
            correct: "Misinformation",
            wrong: ["Missinformation", "Misinformattion"]
        },
        {
            definition: "The study of signs and symbols in communication is?",
            correct: "Semiotics",
            wrong: ["Semiotiks", "Semiotix"]
        },
        {
            definition: 'Which philosopher declared "God is dead"?',
            correct: "Nietzsche",
            wrong: ["Nietzche", "Neitzche"]
        },
        {
            definition: "The subject that analyzes media messages and bias is?",
            correct: "Media literacy",
            wrong: ["Midia Literasy", "Media litericie"]
        },
        {
            definition: "The state of being uncertain or confused.",
            correct: "Ambiguity",
            wrong: ["Ambiguety", "Ambiguiti"]
        },
        {
            definition: "Extreme greed for wealth or material gain.",
            correct: "Avarice",
            wrong: ["Avarise", "Avaricee"]
        },
        {
            definition: "A short and amusing or interesting story about a real incident or person.",
            correct: "Anecdote",
            wrong: ["Anecdout", "Anekdote"]
        },
        {
            definition: "Impossible to understand or interpret.",
            correct: "Unfathomable",
            wrong: ["Unfathamable", "Unfathomible"]
        },
        {
            definition: "The study of human population and statistics is called?",
            correct: "Demography",
            wrong: ["Demografy", "Demograpy"]
        },
        {
            definition: "The philosophy that emphasizes reason and logic as the main source of knowledge.",
            correct: "Rationalism",
            wrong: ["Rationallism", "Racionalism"]
        },
        {
            definition: "Who proposed the heliocentric theory of the solar system?",
            correct: "Nicolaus Copernicus",
            wrong: ["Nicholas Copernicus", "Nicolaus Kopernicus"]
        },
        {
            definition: "Who was the British Prime Minister during most of World War II?",
            correct: "Winston Churchill",
            wrong: ["Winston Churchil", "Winston Churchell"]
        },
        {
            definition: "The document that officially ended World War I was called?",
            correct: "Treaty of Versailles",
            wrong: ["Treaty of Versails", "Treaty of Versalles"]
        }
    ]
};

const state = {
    difficulty: null,
    level: 0,
    score: 0,
    correct: 0,
    total: 0,
    questions: [],
    currentQ: null,
    hintsLeft: 3,
    timer: null,
    timeLeft: 15,
    paused: false,
    settings: {
        timerDuration: 15,
        autoContinue: true,
        animations: true,
        fontSize: 'medium'
    }
};

const $ = id => document.getElementById(id);

function shuffle(arr) {
    const a = [...arr];
    for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
}

const screens = { menu: 'menuScreen', game: 'gameScreen', result: 'resultScreen', settings: 'settingsScreen', guide: 'guideScreen' };

function showScreen(name) {
    Object.values(screens).forEach(id => $(id).classList.remove('active'));
    $(screens[name]).classList.add('active');
    $('topIcons').style.display = (name === 'menu') ? 'flex' : 'none';
}

function startGame() {
    state.level = 0;
    state.score = 0;
    state.correct = 0;
    state.hintsLeft = 3;
    state.questions = shuffle(questionBank[state.difficulty]);
    state.total = state.questions.length;

    $('totalLevels').textContent = state.total;
    $('scoreDisplay').textContent = '0';
    updateHintDots();
    showScreen('game');
    loadQuestion();
}

function loadQuestion() {
    if (state.level >= state.total) { endGame(); return; }

    state.level++;
    state.currentQ = state.questions[state.level - 1];

    $('currentLevel').textContent = state.level;
    $('definitionText').textContent = state.currentQ.definition;

    // Progress bar
    $('progressFill').style.width = ((state.level - 1) / state.total * 100) + '%';

    buildChoices();
    startTimer();
}

function buildChoices() {
    const letters = ['A', 'B', 'C'];
    const pool = shuffle([state.currentQ.correct, ...state.currentQ.wrong]);
    const grid = $('choicesGrid');
    grid.innerHTML = '';

    pool.forEach((word, i) => {
        const btn = document.createElement('button');
        btn.className = 'choice-btn';
        btn.dataset.word = word;
        btn.innerHTML = `<span class="choice-letter">${letters[i]}.</span>${word}`;
        btn.addEventListener('click', () => checkAnswer(btn, word));
        grid.appendChild(btn);
    });
}

function checkAnswer(btn, word) {
    clearInterval(state.timer);
    document.querySelectorAll('.choice-btn').forEach(b => b.disabled = true);

    if (word === state.currentQ.correct) {
        btn.classList.add('correct');
        state.score += 10;
        state.correct += 1;
        $('scoreDisplay').textContent = state.score;
    } else {
        btn.classList.add('wrong');
        document.querySelectorAll('.choice-btn').forEach(b => {
            if (b.dataset.word === state.currentQ.correct) b.classList.add('correct');
        });
    }

    if (state.settings.autoContinue) setTimeout(loadQuestion, 1600);
}

function startTimer() {
    state.timeLeft = state.settings.timerDuration;
    $('timeLeft').textContent = state.timeLeft;
    $('timerBadge').classList.remove('warning');

    state.timer = setInterval(() => {
        if (state.paused) return;
        state.timeLeft--;
        $('timeLeft').textContent = state.timeLeft;
        if (state.timeLeft <= 5) $('timerBadge').classList.add('warning');
        if (state.timeLeft <= 0) {
            clearInterval(state.timer);
            if (state.settings.autoContinue) setTimeout(loadQuestion, 900);
        }
    }, 1000);
}

function useHint() {
    if (state.hintsLeft <= 0) return;
    const candidates = [...document.querySelectorAll('.choice-btn:not(.eliminated):not(.correct):not(.wrong)')]
        .filter(b => b.dataset.word !== state.currentQ.correct);
    if (!candidates.length) return;

    const pick = candidates[Math.floor(Math.random() * candidates.length)];
    pick.classList.add('eliminated');

    state.hintsLeft--;
    updateHintDots();
    if (state.hintsLeft <= 0) $('hintBtn').disabled = true;
}

function updateHintDots() {
    document.querySelectorAll('.hint-dot').forEach((dot, i) => {
        dot.classList.toggle('used', i >= state.hintsLeft);
    });
    $('hintBtn').disabled = (state.hintsLeft <= 0);
}

function endGame() {
    clearInterval(state.timer);
    const acc = Math.round((state.correct / state.total) * 100);

    $('finalScore').textContent = state.score;
    $('accuracy').textContent = acc + '%';

    const msg = $('resultMessage');
    if (acc >= 90) {
        msg.textContent = 'Excellent! Outstanding performance!';
        msg.className = 'result-message excellent';
    } else if (acc >= 70) {
        msg.textContent = 'Good job! Keep it up!';
        msg.className = 'result-message good';
    } else {
        msg.textContent = 'Needs Improvement. Practice more!';
        msg.className = 'result-message needs-improvement';
    }

    $('progressFill').style.width = '100%';
    showScreen('result');
}

function togglePause() {
    state.paused = !state.paused;
    $('pauseOverlay').classList.toggle('active', state.paused);
}

function quitGame() {
    clearInterval(state.timer);
    state.paused = false;
    $('pauseOverlay').classList.remove('active');
    returnToMenu();
}

function returnToMenu() {
    clearInterval(state.timer);
    document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('selected'));
    $('playBtn').disabled = true;
    state.difficulty = null;
    showScreen('menu');
}

document.querySelectorAll('.difficulty-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        state.difficulty = btn.dataset.difficulty;
        $('playBtn').disabled = false;
    });
});

// Navigation
$('playBtn').addEventListener('click', startGame);
$('pauseBtn').addEventListener('click', togglePause);
$('resumeBtn').addEventListener('click', togglePause);
$('quitBtn').addEventListener('click', quitGame);
$('hintBtn').addEventListener('click', useHint);
$('playAgainBtn').addEventListener('click', returnToMenu);
$('guideBtn').addEventListener('click', () => showScreen('guide'));
$('settingsBtn').addEventListener('click', () => showScreen('settings'));
$('backFromSettings').addEventListener('click', () => showScreen('menu'));
$('backFromGuide').addEventListener('click', () => showScreen('menu'));

// Settings
$('timerDuration').addEventListener('change', e => {
    state.settings.timerDuration = +e.target.value;
});
$('fontSize').addEventListener('change', e => {
    state.settings.fontSize = e.target.value;
    const sz = e.target.value;
    document.documentElement.style.fontSize =
        sz === 'small' ? '14px' : sz === 'large' ? '18px' : '16px';
});
['autoContinueToggle', 'animationsToggle'].forEach(id => {
    $(id).addEventListener('click', function () {
        this.classList.toggle('on');
        if (id === 'autoContinueToggle') state.settings.autoContinue = this.classList.contains('on');
        if (id === 'animationsToggle') state.settings.animations = this.classList.contains('on');
    });
});